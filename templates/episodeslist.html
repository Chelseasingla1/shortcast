
{% extends 'base.html' %}

{% block content %}
  <div class="site-wrap">



      <div class="site-section bg-light">

        <div class="container">

          <div class="row mb-5">

            <div class="col-md-12 text-center">


                 <!-- Search bar -->
            <form method="GET" action="{{ url_for('views.podcast') }}">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">Search</span>
                </div>
                <input type="text" class="form-control" name="title" value="{{ request.args.get('title', '') }}" placeholder="Search by Title">
              </div>

              <!-- Dropdown for Filter Criteria -->
              <div class="dropdown mt-4">
                <button class="btn btn-primary dropdown-toggle bg-dark" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Filter by Criteria
                </button>
                <div class="dropdown-menu" aria-labelledby="filterDropdown">
                  <a class="dropdown-item" href="?category=Technology">By Category: Technology</a>
                  <a class="dropdown-item" href="?category=Business">By Category: Business</a>
                  <a class="dropdown-item" href="?category=Comedy">By Category: Comedy</a>
                  <a class="dropdown-item" href="?">Clear Filters</a>
                </div>
              </div>
            </form>




              <h2 class="font-weight-bold text-black mt-5">Episodes</h2>
            </div>
          </div>
          <div class="row">
              {% for episode in episodes %}
<div class="col-md-4">
    <div class="d-block podcast-entry bg-white mb-5" data-aos="fade-up">
        <div class="image w-100" style="height: 300px; background-image: url('/static/images/img_2.jpg');"></div>
        <div class="text w-100">
            <h3 class="font-weight-light">
                <a href="single-post.html">{{ episode.title }}</a>
            </h3>
            <div class="text-white mb-3">
                <span class="text-black-opacity-05">
                    <small> <span class="sep">/</span> {{ episode.publish_date }}<span class="sep">/</span> 1:30:20</small>
                </span>
            </div>
            <p class="mb-4">
                {{ episode.description }}
            </p>

            <!-- Interactive Heart (Favorite) Icon -->
            <div class="favorite-icon mb-3">
                <i class="fas fa-heart" id="favorite-icon-{{ loop.index }}" style="color: #bdc3c7; cursor: pointer;"></i>
            </div>

            <!-- Add to Playlist Button -->
            <button class="btn btn-primary" data-toggle="modal" data-target="#playlistModal{{ loop.index }}">Add to Playlist</button>

            <!-- Modal for Playlist Selection -->
            <div class="modal fade" id="playlistModal{{ loop.index }}" tabindex="-1" role="dialog" aria-labelledby="playlistModalLabel{{ loop.index }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="playlistModalLabel{{ loop.index }}">Choose Playlist</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Playlist options to select from -->
                            <ul class="list-group">
                                {% for playlist in playlists %}
                                    <li class="list-group-item">
                                        <button class="btn btn-link" onclick="addToPlaylist({{ episode.id }}, {{ playlist.id }})">
                                            {{ playlist.title }}
                                        </button>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

                {% endfor %}
              </div>
            </div>
          </div>

        </div>






{% endblock %}

 {% block otherscripts %}
     <script>
    function addToPlaylist(episodeId, playlistId) {
        // Send AJAX request to Flask route to add episode to playlist
        fetch(`/add_to_playlist/${episodeId}/${playlistId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'  // Include CSRF token for security
            },
            body: JSON.stringify({ episode_id: episodeId, playlist_id: playlistId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Episode added to playlist!');
            } else {
                alert('Error adding episode to playlist.');
            }
        });
    }
</script>


 <script>
    // Loop through each podcast entry to add event listeners for heart icon and rating stars
    document.querySelectorAll('.favorite-icon').forEach((icon, index) => {
        const heartIcon = icon.querySelector('.fas.fa-heart');
        const ratingElement = document.getElementById(`rating-${index + 1}`);
        const ratingValueDisplay = document.getElementById(`rating-value-${index + 1}`);
        let rating = 0;

        // Add click event listener to the heart icon to toggle favorite state
        heartIcon.addEventListener('click', () => {
            if (heartIcon.style.color === 'rgb(189, 195, 199)') {  // Default color (not favorited)
                heartIcon.style.color = '#e74c3c'; // Red color (favorited)
            } else {
                heartIcon.style.color = '#bdc3c7'; // Default color (not favorited)
            }
        });

        // Add click event listener to each star
        ratingElement.querySelectorAll('i').forEach(star => {
            star.addEventListener('click', () => {
                rating = star.getAttribute('data-index'); // Get the index of the clicked star
                updateRatingDisplay(rating); // Update the rating display
            });
        });

        // Update the displayed rating
        function updateRatingDisplay(rating) {
            // Change the text to display the selected rating
            ratingValueDisplay.textContent = `Rating: ${rating}/5`;

            // Highlight stars based on the rating
            ratingElement.querySelectorAll('i').forEach(star => {
                if (star.getAttribute('data-index') <= rating) {
                    star.style.color = '#f39c12'; // Filled star
                } else {
                    star.style.color = '#bdc3c7'; // Empty star
                }
            });
        }
    });
</script>
 {% endblock %}